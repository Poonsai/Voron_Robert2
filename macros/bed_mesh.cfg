#####################################################################
#   Bed Mesh Profiles
#   Save and load bed mesh profiles for different materials
#####################################################################

[gcode_macro SAVE_MESH]
description: Save current bed mesh as profile
gcode:
    {% set name = params.NAME|default("default")|string %}
    {% set confirm = params.CONFIRM|default("true")|lower == "true" %}
    
    BED_MESH_PROFILE SAVE="{name}"
    
    {% if confirm %}
        M118 Bed mesh saved as "{name}"
        { action_respond_info(f"Bed mesh saved as: {name}") }
    {% endif %}

[gcode_macro LOAD_MESH]
description: Load a saved bed mesh profile
gcode:
    {% set name = params.NAME|default("default")|string %}
    
    BED_MESH_PROFILE LOAD="{name}"
    M118 Loaded bed mesh profile "{name}"

[gcode_macro LIST_MESHES]
description: List all saved bed mesh profiles
gcode:
    {% set profiles = printer.configfile.settings.bed_mesh.profiles|default({}) %}
    
    M118 ===== Bed Mesh Profiles =====
    {% if profiles %}
        {% for name, data in profiles.items() %}
            M118 - {name}
        {% endfor %}
    {% else %}
        M118 No profiles saved
    {% endif %}
    M118 ==============================

[gcode_macro DELETE_MESH]
description: Delete a bed mesh profile
gcode:
    {% set name = params.NAME|string %}
    
    BED_MESH_PROFILE REMOVE="{name}"
    M118 Deleted bed mesh profile "{name}"

[gcode_macro CALIBRATE_MESH]
description: Run bed mesh calibration and save
gcode:
    {% set name = params.NAME|default("default")|string %}
    {% set runs = params.RUNS|default(2)|int %}
    
    M118 Running bed mesh calibration...
    BED_MESH_CALIBRATE RUNS={runs}
    BED_MESH_PROFILE SAVE="{name}"
    M118 Calibration complete, saved as "{name}"
