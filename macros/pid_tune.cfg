#####################################################################
#   PID Tuning
#   Auto-tune heaters for accurate temperature control
#####################################################################

[gcode_macro PID_TUNE_BED]
description: Auto-tune bed heater PID
gcode:
    {% set temp = params.TEMP|default(60)|int %}
    {% set cycles = params.CYCLES|default(8)|int %}
    
    M118 Tuning bed to {temp}C with {cycles} cycles...
    PID_TUNE HEATER=heater_bed TARGET={temp} CYCLES={cycles}
    SAVE_CONFIG
    M118 Bed PID tuning complete!

[gcode_macro PID_TUNE_EXTRUDER]
description: Auto-tune extruder heater PID
gcode:
    {% set temp = params.TEMP|default(200)|int %}
    {% set cycles = params.CYCLES|default(8)|int %}
    
    M118 Tuning extruder to {temp}C with {cycles} cycles...
    PID_TUNE HEATER=extruder TARGET={temp} CYCLES={cycles}
    SAVE_CONFIG
    M118 Extruder PID tuning complete!

[gcode_macro PID_TUNE_ALL]
description: Auto-tune both bed and extruder PID
gcode:
    {% set bed_temp = params.BED_TEMP|default(60)|int %}
    {% set extruder_temp = params.EXTRUDER_TEMP|default(200)|int %}
    
    M118 Starting full PID tuning...
    
    # Tune bed first
    PID_TUNE_BED TEMP={bed_temp}
    
    # Tune extruder
    PID_TUNE_EXTRUDER TEMP={extruder_temp}
    
    M118 All PID tuning complete! Run SAVE_CONFIG if not already saved.
